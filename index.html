<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMEDAN - NIPOST Discount Form</title>
    <!-- Favicon: Using an emoji as a data URI for simplicity -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“¬</text></svg>">
    <!-- Google Font: Inter for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* General Body Styles */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f2f5 0%, #e0e2e5 100%); /* Subtle gradient background */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for longer forms */
            min-height: 100vh;
            box-sizing: border-box;
            color: #333; /* Default text color */
            overflow-x: hidden; /* Prevent horizontal scroll on small screens */
        }

        /* Form Container Styling */
        .form-container {
            background-color: #ffffff;
            border-left: 8px solid #002f6c; /* NIPOST dark blue accent */
            border-radius: 12px; /* More rounded corners */
            padding: 35px 30px;
            max-width: 680px; /* Slightly wider for better layout */
            width: 100%;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* Deeper shadow */
            box-sizing: border-box;
            animation: fadeIn 0.8s ease-out; /* Fade-in animation */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth hover effect */
        }

        .form-container:hover {
            transform: translateY(-5px); /* Slight lift on hover */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
        }

        /* Form Header */
        h2 {
            text-align: center;
            color: #002f6c;
            margin-bottom: 30px;
            font-size: 2.2rem; /* Larger font for prominence */
            font-weight: 700; /* Bolder */
            border-bottom: 3px solid #fcbf23; /* NIPOST gold accent */
            padding-bottom: 15px;
            letter-spacing: 0.5px;
            position: relative; /* For pseudo-elements */
        }

        /* Subtle decorative elements for the header */
        h2::before, h2::after {
            content: '';
            position: absolute;
            bottom: -3px; /* Align with border-bottom */
            height: 3px;
            background-color: #fcbf23;
            animation: expandLine 1.5s ease-out forwards;
        }

        h2::before {
            left: 50%;
            transform: translateX(-100%);
            width: 0;
        }

        h2::after {
            right: 50%;
            transform: translateX(100%);
            width: 0;
        }

        /* Info Text */
        .info-text {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
            text-align: center;
        }

        /* Labels */
        label {
            display: block;
            font-weight: 600; /* Semi-bold */
            margin-top: 20px;
            margin-bottom: 8px;
            color: #002f6c; /* Dark blue for labels */
            font-size: 0.95rem;
        }

        /* Input, Textarea, Select Styling */
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px; /* More padding */
            margin-bottom: 18px; /* More space below inputs */
            border-radius: 8px; /* Rounded corners */
            border: 1px solid #dcdcdc; /* Lighter border */
            font-size: 1rem;
            box-sizing: border-box;
            transition: all 0.3s ease; /* Smooth transitions */
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #007bff; /* Brighter blue on focus */
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25); /* Subtle glow on focus */
            background-color: #f9fcff; /* Very light blue background on focus */
        }

        /* Radio Group Styling */
        .radio-group {
            display: flex;
            gap: 40px; /* More space between radio options */
            margin-bottom: 20px;
            align-items: center;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
            width: auto; /* Override 100% width */
            margin-bottom: 0; /* Remove bottom margin */
            cursor: pointer;
        }

        .radio-group label {
            display: inline-flex; /* Align label with radio button */
            align-items: center;
            font-weight: 400; /* Normal weight for radio labels */
            color: #333;
            margin-top: 0;
            margin-bottom: 0;
            cursor: pointer;
        }

        /* Button Styling */
        button {
            background-color: #002f6c; /* NIPOST dark blue */
            color: #fff;
            border: none;
            cursor: pointer;
            font-weight: 600; /* Semi-bold */
            font-size: 1.1rem;
            padding: 15px 25px;
            border-radius: 8px;
            margin-top: 30px;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 47, 108, 0.2); /* Button shadow */
        }

        button:hover {
            background-color: #004a99; /* Slightly lighter blue on hover */
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 6px 15px rgba(0, 47, 108, 0.3); /* Enhanced shadow on hover */
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 47, 108, 0.2);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Space between buttons */
            margin-top: 30px;
        }

        .action-buttons button {
            margin-top: 0; /* Override default button margin */
        }

        /* Footer Message */
        .footer-message {
            text-align: center;
            margin-top: 30px;
            color: #888;
            font-size: 0.8rem;
            padding-top: 15px;
            border-top: 1px dashed #e0e0e0;
        }

        /* Response Message */
        #responseMessage {
            text-align: center;
            margin-top: 25px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            opacity: 0; /* Hidden by default */
            transform: translateY(10px); /* Slightly below */
            animation: slideIn 0.5s forwards; /* Animation for appearance */
        }

        #responseMessage.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Loader Styling */
        .loader {
            text-align: center;
            margin-top: 25px;
            color: #002f6c;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .loader.visible {
            opacity: 1;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3; /* Light grey */
            border-top-color: #002f6c; /* NIPOST dark blue */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader.hidden {
            display: none;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes expandLine {
            from { width: 0; }
            to { width: 40%; } /* Adjust width as needed */
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
            color: #002f6c;
            font-size: 1.5rem;
        }

        .modal-close-button {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #888;
            transition: color 0.2s ease;
        }

        .modal-close-button:hover {
            color: #333;
        }

        .modal-body pre {
            background-color: #f8f8f8;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap; /* Preserve whitespace and wrap long lines */
            word-wrap: break-word;
            font-family: 'Inter', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #444;
            max-height: 40vh; /* Limit height for scrollability */
            overflow-y: auto;
        }

        .modal-footer {
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: right;
        }

        .modal-footer button {
            width: auto;
            padding: 10px 20px;
            font-size: 1rem;
            margin-left: 10px;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .form-container {
                padding: 25px 20px;
                border-left: none; /* Remove left border on smaller screens */
                border-top: 6px solid #002f6c; /* Add top border for mobile accent */
                border-radius: 8px; /* Slightly less rounded for mobile */
            }

            h2 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }

            label {
                margin-top: 15px;
                font-size: 0.9rem;
            }

            input, textarea, select, button {
                padding: 10px 12px;
                font-size: 0.95rem;
            }

            .radio-group {
                flex-direction: column; /* Stack radio buttons vertically */
                gap: 12px;
                align-items: flex-start;
            }

            button {
                font-size: 1rem;
                padding: 12px 20px;
            }

            .info-text {
                font-size: 0.85rem;
            }

            .action-buttons {
                gap: 10px;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }
            .modal-header h3 {
                font-size: 1.2rem;
            }
            .modal-close-button {
                font-size: 1.5rem;
            }
            .modal-body pre {
                font-size: 0.9rem;
                padding: 10px;
            }
            .modal-footer button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .form-container {
                padding: 20px 15px;
            }
            h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <div class="form-container">
        <h2>SMEDAN - NIPOST Discount Form</h2>
        <p class="info-text">
            Welcome to the SMEDAN-NIPOST Discount Form. Please fill out the form below to apply
            for a 15% discount on your NIPOST services if you are registered with SMEDAN.
            Ensure all fields are filled out correctly before submitting.
        </p>

        <form id="smedanDiscountForm">
            <label for="organizationName">Organization Name:</label>
            <input type="text" id="organizationName" name="Organization Name" placeholder="e.g., ABC Ventures" required>

            <label>Registered with SMEDAN?</label>
            <div class="radio-group">
                <input type="radio" id="smedanYes" name="Registered with SMEDAN?" value="Yes" checked>
                <label for="smedanYes">Yes</label>
                <input type="radio" id="smedanNo" name="Registered with SMEDAN?" value="No">
                <label for="smedanNo">No</label>
            </div>

            <label for="amountPurchased">Amount Purchased (N):</label>
            <input type="number" id="amountPurchased" name="Amount Purchased (N)" placeholder="e.g., 50000" min="0" required>

            <label for="discountAmount">15% Discount (N):</label>
            <input type="text" id="discountAmount" name="15% Discount (N)" readonly value="0.00">
            <!-- Readonly as this is calculated by JS -->

            <label for="finalAmountPaid">Final Amount Paid (N):</label>
            <input type="text" id="finalAmountPaid" name="Final Amount Paid (N)" readonly value="0.00">
            <!-- Readonly as this is calculated by JS -->

            <label for="remarks">Remarks:</label>
            <textarea id="remarks" name="Remarks" placeholder="Any additional notes..."></textarea>

            <label for="dateOfTransaction">Date of Transaction:</label>
            <input type="date" id="dateOfTransaction" name="Date of Transaction" required>

            <label for="officerId">Officer ID:</label>
            <input type="text" id="officerId" name="Officer ID" placeholder="e.g., PN number" required>

            <label for="state">State:</label>
            <select id="state" name="State" required>
                <option value="">Select State</option>
            </select>

            <label for="lga">Local Government Area:</label>
            <select id="lga" name="Local Government Area" required>
                <option value="">Select LGA</option>
            </select>

            <label for="postOffice">Post Office:</label>
            <input type="text" id="postOffice" name="Post Office" placeholder="e.g., Garki Post Office" required>

            <div class="action-buttons">
                <button type="submit">Submit Form</button>
                <button type="button" id="generateEmailBtn">Generate Follow-up Email âœ¨</button>
            </div>
        </form>

        <div id="responseMessage"></div>
        <div id="loader" class="loader hidden">
            <div class="spinner"></div>
            Processing your request...
        </div>

        <div class="footer-message">
            Powered by NIPOST â€¢ Digitally enhanced with SMEDAN â€¢ Built by iSec ðŸ”’
        </div>
    </div>

    <!-- Email Draft Modal -->
    <div id="emailModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Follow-up Email Draft</h3>
                <button class="modal-close-button" id="closeEmailModal">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="emailDraftContent"></pre>
            </div>
            <div class="modal-footer">
                <button id="copyEmailBtn">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        // --- Data for your dropdowns ---
        const statesData = {
            "Abia": ["Aba North", "Aba South", "Arochukwu", "Bende", "Ikwuano", "Isiala Ngwa North", "Isiala Ngwa South", "Isuikwuato", "Obingwa", "Ohafia", "Osisioma Ngwa", "Ugwunagbo", "Ukwa East", "Ukwa West", "Umuahia North", "Umuahia South", "Umunneochi"],
            "Adamawa": ["Demsa", "Fufore", "Ganye", "Girei", "Gombi", "Guyuk", "Hong", "Jada", "Lamurde", "Madagali", "Maiha", "Mayo-Belwa", "Michika", "Mubi North", "Mubi South", "Numan", "Shelleng", "Song", "Toungo", "Yola North", "Yola South"],
            "Akwa Ibom": ["Abak", "Eastern Obolo", "Eket", "Esit Eket", "Essien Udim", "Etim Ekpo", "Etinan", "Ibeno", "Ibesikpo Asutan", "Ibiono-Ibom", "Ika", "Ikono", "Ikot Abasi", "Ikot Ekpene", "Ini", "Itu", "Mbo", "Mkpat-Enin", "Nsit-Atai", "Nsit-Ibom", "Nsit-Ubium", "Obot Akara", "Okobo", "Onna", "Oron", "Oruk Anam", "Udung-Uko", "Ukanafun", "Uruan", "Urue-Offong/Oruko", "Uyo"],
            "Anambra": ["Aguata", "Anambra East", "Anambra West", "Anaocha", "Awka North", "Awka South", "Ayame", "Dunukofia", "Ekwusigo", "Idemili North", "Idemili South", "Ihiala", "Njikoka", "Nnewi North", "Nnewi South", "Ogbaru", "Onitsha North", "Onitsha South", "Orumba North", "Orumba South", "Oyi"],
            "Bauchi": ["Alkaleri", "Bauchi", "Bogoro", "Damban", "Darazo", "Dass", "Gamawa", "Ganjuwa", "Giade", "Itas/Gadau", "Jama'are", "Katagum", "Kirfi", "Misau", "Ningi", "Shira", "Tafawa Balewa", "Toro", "Warji", "Zaki"],
            "Bayelsa": ["Brass", "Ekeremor", "Kolokuma/Opokuma", "Nembe", "Ogbia", "Sagbama", "Southern Ijaw", "Yenagoa"],
            "Benue": ["Ado", "Agatu", "Apa", "Buruku", "Gboko", "Guma", "Gwer East", "Gwer West", "Katsina-Ala", "Konshisha", "Kwande", "Logo", "Makurdi", "Obi", "Ogbadibo", "Ohimini", "Oju", "Okpokwu", "Oturkpo", "Tarka", "Ukum", "Ushongo", "Vandeikya"],
            "Borno": ["Abadam", "Askira/Uba", "Bama", "Bayo", "Biu", "Chibok", "Damboa", "Dikwa", "Gubio", "Guzamala", "Gwoza", "Hawul", "Jere", "Kaga", "Kala/Balge", "Konduga", "Kukawa", "Kwaya Kusar", "Mafa", "Magumeri", "Maiduguri", "Marte", "Mobbar", "Monguno", "Ngala", "Nganzai", "Shani"],
            "Cross River": ["Abi", "Akamkpa", "Akpabuyo", "Bakassi", "Bekwarra", "Biase", "Boki", "Calabar Municipal", "Calabar South", "Etung", "Ikom", "Obanliku", "Obubra", "Obudu", "Odukpani", "Ogoja", "Yakuur", "Yala"],
            "Delta": ["Aniocha North", "Aniocha South", "Bomadi", "Burutu", "Ethiope East", "Ethiope West", "Ika North East", "Ika South", "Isoko North", "Isoko South", "Ndokwa East", "Ndokwa West", "Okpe", "Oshimili North", "Oshimili South", "Patani", "Sapele", "Udu", "Ughelli North", "Ughelli South", " "],
            "Ebonyi": ["Abakaliki", "Afikpo North", "Afikpo South", "Ebonyi", "Ezza North", "Ezza South", "Ikwo", "Ishielu", "Ivo", "Izzi", "Ohaozara", "Ohaukwu", "Onicha"],
            "Edo": ["Akoko-Edo", "Egor", "Esan Central", "Esan North-East", "Esan South-East", "Esan West", "Etsako Central", "Etsako East", "Etsako West", "Igwbaz", "Ikpoba Okha", "Orhionmwon", "Oredo", "Ovia North-East", "Ovia South-West", "Owan East", "Owan West", "Uhunmwonde"],
            "Ekiti": ["Ado Ekiti", "Efon", "Ekiti East", "Ekiti South-West", "Ekiti West", "Emure", "Gbonyin", "Ido Osi", "Ijero", "Ikere", "Ikole", "Ilejemeje", "Irepodun/Ifelodun", "Ise/Orun", "Moba", "Oye"],
            "Enugu": ["Aninri", "Awgu", "Enugu East", "Enugu North", "Enugu South", "Ezeagu", "Igbo Etiti", "Igbo Eze North", "Igbo Eze South", "Isi Uzo", "Nkanu East", "Nkanu West", "Nsukka", "Oji River", "Udenu", "Udi", "Uzo-Uwani"],
            "Gombe": ["Akko", "Balanga", "Billiri", "Dukku", "Funakaye", "Gombe", "Kaltungo", "Kwami", "Nafada", "Shongom", "Yamaltu/Deba"],
            "Imo": ["Aboh Mbaise", "Ahiazu Mbaise", "Ehime Mbano", "Ezinihitte", "Ideato North", "Ideato South", "Ihitte/Uboma", "Ikeduru", "Isiala Mbano", "Isu", "Mbaitoli", "Ngor Okpala", "Njaba", "Nkwerre", "Nwangele", "Obowo", "Oguta", "Ohaji/Egbema", "Okigwe", "Onuimo", "Orlu", "Orsu", "Oru East", "Oru West", "Owerri Municipal", "Owerri North", "Owerri West"],
            "Jigawa": ["Auyo", "Babura", "Biriniwa", "Birnin Kudu", "Buji", "Dutse", "Gagarawa", "Garki", "Gumel", "Guri", "Gwaram", "Hadejia", "Jahun", "Kafin Hausa", "Kazaure", "Kiri Kasama", "Kiyawa", "Kaugama", "Maigatari", "Malam Madori", "Miga", "Ringim", "Roni", "Sule Tankarkar", "Taura", "Yankwashi"],
            "Kaduna": ["Birnin Gwari", "Chikun", "Giwa", "Igabi", "Ikara", "Jaba", "Jema'a", "Kachia", "Kaduna North", "Kaduna South", "Kagarko", "Kajuru", "Kaura", "Kauru", "Kubau", "Kudan", "Lere", "Makarfi", "Sabon Gari", "Sanga", "Soba", "Zangon Kataf", "Zaria"],
            "Kano": ["Ajingi", "Albasu", "Bagwai", "Bebeji", "Bichi", "Bunkure", "Dala", "Dambatta", "Dawakin Kudu", "Dawakin Tofa", "Doguwa", "Fagge", "Gabasawa", "Garko", "Garun Mallam", "Gaya", "Gezawa", "Gwale", "Gwarzo", "Kabo", "Kano Municipal", "Karaye", "Kibiya", "Kiru", "Kumbotso", "Kunchi", "Kura", "Madobi", "Makoda", "Minjibir", "Nassarawa", "Rano", "Rimin Gado", "Rogo", "Shanono", "Sumaila", "Takai", "Tarauni", "Tofa", "Tsanyawa", "Tudun Wada", "Ungogo", "Warawa", "Wudil"],
            "Katsina": ["Bakori", "Batagarawa", "Batsari", "Baure", "Bindawa", "Charanchi", "Dandume", "Danja", "Dan Musa", "Daura", "Dutsi", "Dutsin-Ma", "Faskari", "Funtua", "Ingawa", "Jibia", "Kafur", "Kaita", "Kankara", "Kankia", "Katsina", "Kurfi", "Kusada", "Mai'Adua", "Malumfashi", "Mani", "Mashi", "Matazu", "Musawa", "Rimi", "Sabuwa", "Safana", "Sandamu", "Zango"],
            "Kebbi": ["Aleiro", "Arewa Dandi", "Argungu", "Augie", "Bagudo", "Birnin Kebbi", "Bunza", "Dandi", "Fakai", "Gwandu", "Jega", "Kalgo", "Koko/Besse", "Maiyama", "Ngaski", "Sakaba", "Shanga", "Suru", "Wasagu/Danko", "Yauri", "Zuru"],
            "Kogi": ["Adavi", "Ajaokuta", "Ankpa", "Bassa", "Dekina", "Ibaji", "Idah", "Igalamela Odolu", "Ijumu", "Kabba/Bunu", "Kogi", "Lokoja", "Mopa-Muro", "Ofu", "Ogori/Magongo", "Okehi", "Okene", "Olamaboro", "Omala", "Yagba East", "Yagba West"],
            "Kwara": ["Asa", "Baruten", "Edu", "Ekiti", "Ifelodun", "Ilorin East", "Ilorin South", "Ilorin West", "Isin", "Kaiama", "Moro", "Offa", "Oke Ero", "Oyun", "Pategi"],
            "Lagos": ["Agege", "Ajeromi-Ifelodun", "Alimosho", "Amuwo-Odofin", "Apapa", "Badagry", "Epe", "Eti-Osa", "Ibeju-Lekki", "Ifako-Ijaiye", "Ikeja", "Ikorodu", "Kosofe", "Lagos Island", "Lagos Mainland", "Mushin", "Ojo", "Oshodi-Isolo", "Shomolu", "Surulere"],
            "Nasarawa": ["Akwanga", "Awe", "Doma", "Karu", "Keana", "Keffi", "Kokona", "Lafia", "Nasarawa", "Nasarawa Egon", "Obi", "Toto", "Wamba"],
            "Niger": ["Agaie", "Agwara", "Bida", "Borgu", "Bosso", "Chanchaga", "Edati", "Gbako", "Gurara", "Katcha", "Kontagora", "Lapai", "Lavun", "Magama", "Mariga", "Mashegu", "Mokwa", "Paikoro", "Rafi", "Rijau", "Shiroro", "Suleja", "Tafa", "Wushishi"],
            "Ogun": ["Abeokuta North", "Abeokuta South", "Ado-Odo/Ota", "Egbado North", "Egbado South", "Ewekoro", "Ijebu East", "Ijebu North", "Ijebu North East", "Ijebu Ode", "Ikenne", "Imeko Afon", "Ipokia", "Obafemi Owode", "Odeda", "Odogbolu", "Ogun Waterside", "Remo North", "Sagamu"],
            "Ondo": ["Akoko North-East", "Akoko North-West", "Akoko South-Akure East", "Akoko South-West", "Akure North", "Akure South", "Ese Odo", "Idanre", "Ifedore", "Ilaje", "Ile Oluji/Okeigbo", "Irele", "Odigbo", "Okitipupa", "Ondo East", "Ondo West", "Ose", "Owo"],
            "Osun": ["Atakunmusa East", "Atakunmusa West", "Aiyedaade", "Aiyedire", "Bolwaduro", "Borkin", "Ede North", "Ede South", "Egbedore", "Ejigbo", "Ife Central", "Ife East", "Ife North", "Ife South", "Ifelodun", "Ila", "Ilesa East", "Ilesa West", "Irepodun", "Irewole", " "],
            "Oyo": ["Akinyele", "Atiba", "Atisbo", "Egbeda", "Ibadan North", "Ibadan North-East", "Ibadan North-West", "Ibadan South-East", "Ibadan South-West", "Ibram", "Ido", "Ifeloju", "Irepo", "Iseyin", "Itesiwaju", "Iwajowa", "Kajola", " "],
            "Plateau": ["Barkin Ladi", "Bassa", "Bokkos", "Jos East", "Jos North", "Jos South", "Kanam", "Kanke", "Langtang North", "Langtang South", "Mangu", "Mikang", "Pankshin", "Qua'an Pan", "Riyom", "Shendam", "Wase"],
            "Rivers": ["Abua/Odual", "Ahoada East", "Ahoada West", "Akuku-Toru", "Andoni", "Bonny", "Degema", "Eleme", "Emuoha", "Etche", "Gokana", "Ikwerre", "Khana", "Obio/Akpor", "Ogba/Egbema/Ndoni", "Ogu/Bolo", "Okrika", "Omuma", "Opobo/Nkoro", "Oyigbo", "Port Harcourt", "Tai"],
            "Sokoto": ["Binji", "Bodinga", "Dange Shuni", "Gada", "Goronyo", "Gudu", "Gwadabawa", "Illela", "Kebbe", "Kware", "Rabah", "Sabon Birni", "Shagari", "Silame", "Sokoto North", "Sokoto South", "Tambuwal", "Tangaza", "Tureta", "Wamako", "Wurno", "Yabo"],
            "Taraba": ["Ardo Kola", "Bali", "Donga", "Gashaka", "Gassol", "Ibi", "Jalingo", "Karim Lamido", "Kaufu", "Lau", "Sardauna", "Takum", "Ussa", "Wukari", "Yorro", "Zing"],
            "Yobe": ["Bade", "Bursari", "Damaturu", "Dandali", "Fika", "Fune", "Geidam", "Gogaram", "Gujba", "Gulani", "Jakusko", "Karasuwa", "Machina", "Nangere", "Nguru", "Potiskum", "Tarmuwa", "Yunusari", "Yusufari"],
            "Zamfara": ["Anka", "Bakura", "Birnin Magaji/Kiyaw", "Bukkuyum", "Bungudu", "Gummi", "Gusau", "Kaura Namoda", "Maradun", "Maru", "Shinkafi", "Talata Mafara", "Tsafe", "Zurmi"],
            "Federal Capital Territory": ["Abaji", "Abuja Municipal", "Bwari", "Gwagwalada", "Kuje", "Kwali"]
        };

        // --- Element References ---
        const form = document.getElementById('smedanDiscountForm');
        // REMEMBER TO REPLACE THIS WITH YOUR ACTUAL DEPLOYED GOOGLE APPS SCRIPT WEB APP URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwaLh6r0PGiE0Dw6IJsxf2Qp9J4WqpTf0qhiPTtLOWBD1G2iNASA8NxRJn4sFSJSwIr/exec'; // Your Google Apps Script URL
        const responseMessageDiv = document.getElementById('responseMessage');
        const loaderDiv = document.getElementById('loader'); // Reference to the loader div

        const stateSelect = document.getElementById('state');
        const lgaSelect = document.getElementById('lga');
        const officerIdInput = document.getElementById('officerId'); // Changed to input reference
        const amountPurchasedInput = document.getElementById('amountPurchased');
        const discountAmountInput = document.getElementById('discountAmount');
        const finalAmountPaidInput = document.getElementById('finalAmountPaid');
        const dateOfTransactionInput = document.getElementById('dateOfTransaction');
        const organizationNameInput = document.getElementById('organizationName');
        const postOfficeInput = document.getElementById('postOffice');
        const generateEmailBtn = document.getElementById('generateEmailBtn');

        // Modal elements
        const emailModalOverlay = document.getElementById('emailModalOverlay');
        const closeEmailModalBtn = document.getElementById('closeEmailModal');
        const emailDraftContent = document.getElementById('emailDraftContent');
        const copyEmailBtn = document.getElementById('copyEmailBtn');


        // --- Functions to Populate Dropdowns ---

        function populateStates() {
            stateSelect.innerHTML = '<option value="">Select State</option>'; // Clear existing options
            const sortedStates = Object.keys(statesData).sort(); // Sort states alphabetically
            sortedStates.forEach(stateName => {
                const option = document.createElement('option');
                option.value = stateName;
                option.textContent = stateName;
                stateSelect.appendChild(option);
            });
        }

        function populateLgas() {
            const selectedState = stateSelect.value;
            lgaSelect.innerHTML = '<option value="">Select LGA</option>'; // Clear current LGAs
            if (selectedState && statesData[selectedState]) {
                const sortedLgas = statesData[selectedState].sort(); // Sort LGAs alphabetically
                sortedLgas.forEach(lga => {
                    const option = document.createElement('option');
                    option.value = lga;
                    option.textContent = lga;
                    lgaSelect.appendChild(option);
                });
            }
        }

        // --- Discount Calculation Function ---
        function calculateDiscount() {
            const purchasedAmount = parseFloat(amountPurchasedInput.value) || 0;
            const discount = purchasedAmount * 0.15;
            const finalAmount = purchasedAmount - discount;

            discountAmountInput.value = discount.toFixed(2); // Format to 2 decimal places
            finalAmountPaidInput.value = finalAmount.toFixed(2); // Format to 2 decimal places
        }

        // --- Gemini API Integration: Generate Email Draft ---
        async function generateFollowUpEmail() {
            // Basic validation: Ensure essential fields are filled before generating email
            if (!organizationNameInput.value || !amountPurchasedInput.value || !officerIdInput.value || !stateSelect.value || !lgaSelect.value || !postOfficeInput.value) {
                displayMessage('Please fill in all required fields to generate an email.', 'orange');
                return;
            }

            displayMessage('Generating email...', 'blue');
            loaderDiv.classList.remove('hidden'); // Show loader
            loaderDiv.classList.add('visible'); // Add visible class for transition

            const orgName = organizationNameInput.value;
            const amountPurchased = parseFloat(amountPurchasedInput.value).toFixed(2);
            const discountAmount = parseFloat(discountAmountInput.value).toFixed(2);
            const finalAmountPaid = parseFloat(finalAmountPaidInput.value).toFixed(2);
            const dateOfTransaction = dateOfTransactionInput.value;
            const officerId = officerIdInput.value; // Get value from text input
            const state = stateSelect.value;
            const lga = lgaSelect.value;
            const postOffice = postOfficeInput.value;

            const prompt = `Draft a professional and friendly follow-up email to a customer after they've completed a transaction with NIPOST, receiving a SMEDAN discount.
Include the following details:
- Organization Name: ${orgName}
- Amount Purchased: N${amountPurchased}
- Discount Applied: N${discountAmount} (15%)
- Final Amount Paid: N${finalAmountPaid}
- Date of Transaction: ${dateOfTransaction}
- Officer ID: ${officerId}
- Location: ${postOffice}, ${lga}, ${state}

The email should thank them for their patronage, confirm the transaction details, and encourage future business. Keep it concise and the tone appreciative. Start directly with "Dear [Customer Name]," or "Dear Valued Customer," if a name isn't available.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "AIzaSyCgaUiXqEo189x1ICo8hK33wJb-oebV93A"; // Canvas will automatically provide this in runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                loaderDiv.classList.add('hidden'); // Hide loader
                loaderDiv.classList.remove('visible'); // Remove visible class

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    emailDraftContent.textContent = generatedText;
                    emailModalOverlay.classList.add('visible'); // Show the modal
                    displayMessage('Email draft generated successfully!', 'green');
                } else {
                    displayMessage('Failed to generate email: No content received from AI.', 'red');
                    console.error('AI Response Error:', result);
                }
            } catch (error) {
                loaderDiv.classList.add('hidden'); // Hide loader
                loaderDiv.classList.remove('visible'); // Remove visible class
                displayMessage('An error occurred while contacting the AI. Please try again.', 'red');
                console.error('Gemini API Fetch Error:', error);
            }
        }

        // --- Copy to Clipboard Function ---
        function copyEmailToClipboard() {
            const emailText = emailDraftContent.textContent;
            if (emailText) {
                // Using document.execCommand('copy') for broader iframe compatibility
                const textarea = document.createElement('textarea');
                textarea.value = emailText;
                textarea.style.position = 'fixed'; // Prevent scrolling to bottom
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try {
                    const successful = document.execCommand('copy');
                    const msg = successful ? 'Email copied to clipboard!' : 'Failed to copy email.';
                    alert(msg); // Use a simple alert for copy confirmation
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                    alert('Failed to copy email to clipboard. Please copy manually.');
                }
                document.body.removeChild(textarea);
            }
        }

        // --- Display Message Function (for form feedback) ---
        function displayMessage(message, type) {
            responseMessageDiv.textContent = message;
            responseMessageDiv.classList.add('show'); // Add show class for animation
            if (type === 'green') {
                responseMessageDiv.style.color = 'green';
                responseMessageDiv.style.backgroundColor = '#d4edda';
                responseMessageDiv.style.borderColor = '#28a745';
            } else if (type === 'red') {
                responseMessageDiv.style.color = 'red';
                responseMessageDiv.style.backgroundColor = '#f8d7da';
                responseMessageDiv.style.borderColor = '#dc3545';
            } else if (type === 'blue') {
                responseMessageDiv.style.color = '#0056b3';
                responseMessageDiv.style.backgroundColor = '#e0f2ff';
                responseMessageDiv.style.borderColor = '#007bff';
            } else if (type === 'orange') {
                responseMessageDiv.style.color = '#856404';
                responseMessageDiv.style.backgroundColor = '#fff3cd';
                responseMessageDiv.style.borderColor = '#ffeeba';
            }
            // Hide message after a few seconds
            setTimeout(() => {
                responseMessageDiv.classList.remove('show');
                responseMessageDiv.textContent = '';
            }, 5000);
        }

        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set today's date as default for Date of Transaction
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            dateOfTransactionInput.value = `${year}-${month}-${day}`;

            populateStates();
            populateLgas(); // Populate LGA based on initial state value if any
            calculateDiscount(); // Perform initial calculation if there's a default amount
        });

        stateSelect.addEventListener('change', populateLgas);
        amountPurchasedInput.addEventListener('input', calculateDiscount);
        generateEmailBtn.addEventListener('click', generateFollowUpEmail); // New button listener

        // Modal event listeners
        closeEmailModalBtn.addEventListener('click', () => {
            emailModalOverlay.classList.remove('visible');
        });
        emailModalOverlay.addEventListener('click', (e) => {
            if (e.target === emailModalOverlay) { // Close only if clicking on overlay, not content
                emailModalOverlay.classList.remove('visible');
            }
        });
        copyEmailBtn.addEventListener('click', copyEmailToClipboard);


        // --- Form Submission Logic ---
        form.addEventListener('submit', e => {
            e.preventDefault(); // Prevent the default form submission (page reload)

            displayMessage('Submitting form...', 'blue');
            loaderDiv.classList.remove('hidden'); // Show loader
            loaderDiv.classList.add('visible'); // Add visible class for transition

            // Create a FormData object from the form
            // It automatically picks up all fields with 'name' attributes
            const formData = new FormData(form);

            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                // Check if the response is JSON before parsing
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    return response.json();
                } else {
                    // If not JSON, assume success but no specific data, or handle as plain text
                    return response.text().then(text => {
                        try {
                            return JSON.parse(text); // Try parsing anyway
                        } catch (e) {
                            return { result: 'success', message: 'Form submitted (non-JSON response)', raw: text };
                        }
                    });
                }
            })
            .then(data => {
                loaderDiv.classList.add('hidden'); // Hide loader
                loaderDiv.classList.remove('visible'); // Remove visible class
                if (data.result === 'success') {
                    displayMessage('Form submitted successfully!', 'green');
                    form.reset(); // Clear the form after successful submission
                    // Re-populate initial dropdowns and recalculate after reset
                    populateStates();
                    populateLgas(); // Reset LGA dropdown
                    calculateDiscount(); // Reset calculated fields
                    dateOfTransactionInput.value = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}-${String(new Date().getDate()).padStart(2, '0')}`; // Reset date
                } else {
                    displayMessage('Error submitting form: ' + (data.error || data.message || 'Unknown error'), 'red');
                    console.error('Apps Script Error:', data.error || data.message || data.raw);
                }
            })
            .catch(error => {
                loaderDiv.classList.add('hidden'); // Hide loader
                loaderDiv.classList.remove('visible'); // Remove visible class
                displayMessage('An error occurred during submission. Please check your browser console.', 'red');
                console.error('Fetch Error:', error);
            });
        });
    </script>
</body>
</html>
